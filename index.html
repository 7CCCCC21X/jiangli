<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Alpha Token Volume Board</title>

<!-- â†“â†“â†“ Vercel Webâ€¯Analytics â†“â†“â†“ -->
<script>
  window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
</script>
<script defer src="/_vercel/insights/script.js"></script>
<!-- â†‘â†‘â†‘ Vercel Webâ€¯Analytics â†‘â†‘â†‘ -->

<style>
:root{
  --bg:#f9fafb;--text:#1f2937;--sub:#6b7280;--border:#e5e7eb;
  --green:#16a34a;--red:#dc2626;--primary:#2563eb
}
@media(prefers-color-scheme:dark){
  :root{--bg:#1e293b;--text:#f3f4f6;--sub:#9ca3af;--border:#334155}
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:-apple-system,"Segoe UI","PingFang SC",sans-serif;
  background:var(--bg);color:var(--text);line-height:1.5
}
h1{padding:18px 12px;text-align:center;font-size:1.35rem;color:var(--primary)}
/* æ–°å¢ï¼šæœ€åæ›´æ–°æ—¶é—´æ ·å¼ */
.last-up{
  text-align:center;font-size:.8rem;color:var(--sub);margin-top:-6px;margin-bottom:12px
}
/* ---------- é¡¶æ  ---------- */
#bar{
  max-width:1200px;margin:0 auto 12px;
  display:flex;flex-wrap:wrap;align-items:center;gap:8px;
  padding:0 6px
}
#bar-left{flex:1;display:flex;flex-wrap:wrap;align-items:center;gap:8px}
#bar-left input[type="search"]{flex:1;min-width:160px}
#bar-left input[type="text"]{width:140px}
#bar-left input[type="datetime-local"]{width:190px}
#bar-left input[type="date"]{width:150px}
#bar-left input{
  padding:6px 8px;border:1px solid var(--border);border-radius:4px;font-size:.85rem
}
.btn{
  display:inline-flex;align-items:center;gap:4px;
  padding:6px 12px;font-size:.85rem;border:1px solid var(--primary);
  color:#fff;background:var(--primary);border-radius:4px;cursor:pointer
}
.btn[disabled]{background:#9ca3af;border-color:#9ca3af;cursor:not-allowed}
.badge{
  display:none;padding:0 6px;border-radius:10px;font-size:.7rem;font-weight:700;
  background:#fff;color:var(--primary)
}
#author{font-size:.8rem;white-space:nowrap}
#author a{color:var(--primary);text-decoration:none}
/* ---------- è¡¨æ ¼ ---------- */
table{
  width:100%;max-width:1200px;margin:0 auto;border-collapse:collapse;min-width:620px
}
th,td{
  padding:10px 6px;border-bottom:1px solid var(--border);
  font-size:.85rem;text-align:left;white-space:nowrap
}
tbody tr:hover{background:rgba(0,0,0,.04);cursor:pointer}
th.sortable{cursor:pointer;user-select:none;position:relative}
th.sortable::after{
  content:'â–²';position:absolute;right:4px;font-size:.6rem;color:var(--sub);
  transform:scale(.8);opacity:0;transition:opacity .2s
}
th.sortable.desc::after{content:'â–¼';opacity:1}
th.sortable.asc::after{content:'â–²';opacity:1}
/* Star */
.star{cursor:pointer;font-size:1rem;color:var(--sub);user-select:none;transition:transform .15s,color .15s}
.star.fav{color:#f7b500}.star.bounce{transform:scale(1.4)}
/* é¢œè‰² & å°å­— */
.logo{width:18px;height:18px;margin-right:4px;vertical-align:middle;border-radius:50%}
.up{color:var(--green)}.down{color:var(--red)}
.subl{display:block;font-size:.72rem;color:var(--sub)}
/* Toast */
#toast{
  position:fixed;bottom:40px;left:50%;transform:translateX(-50%);
  background:rgba(0,0,0,.8);color:#fff;padding:8px 16px;border-radius:6px;
  font-size:.85rem;opacity:0;pointer-events:none;transition:opacity .3s
}
/* è‡ªå®šä¹‰åŒºé—´ç»“æœ */
#customVol{max-width:1200px;margin:4px auto 0;font-size:.9rem;color:var(--primary)}
/* æ–°å¢ï¼šæŒ‰å¤©ç»Ÿè®¡ç»“æœåŒº */
#dailyBox{
  max-width:1200px;margin:8px auto 0;padding:6px 0
}
#dailyBox h3{
  font-size:1rem;margin:6px 6px 8px;color:var(--primary)
}
#dailyBox .tip{font-size:.78rem;color:var(--sub);margin:0 6px 8px}
#dailyBox table{width:100%;border-collapse:collapse}
#dailyBox th,#dailyBox td{border-bottom:1px solid var(--border);padding:8px 6px;font-size:.85rem}
#dailyBox tfoot td{font-weight:600}
footer{height:16px;margin-bottom:12px}
@media(max-width:760px){
  #bar-left input[type="datetime-local"]{flex:1;min-width:140px}
}
</style>
</head>
<body>
<h1>BinanceÂ AlphaÂ â€”Â 24HÂ äº¤æ˜“é‡æ’è¡Œæ¦œ</h1>
<p id="lastUp" class="last-up"></p>

<div id="bar">
  <div id="bar-left">
    <input id="search" type="search" placeholder="ğŸ”â€¯æŒ‰ä»£å¸åç§° / ç¬¦å·è¿‡æ»¤â€¦">
    <button id="refreshBtn" class="btn">
      âŸ³â€¯åˆ·æ–°æ•°æ® <span id="progress" class="badge">0%</span>
    </button>

    <!-- åŸæœ‰ï¼šè‡ªå®šä¹‰æ—¶é—´æ®µï¼ˆå•æ¬¡æ€»é‡ï¼‰ -->
    <input id="tokenInput" type="text" placeholder="è¾“å…¥ä»£å¸åç§°">
    <input id="startTime" type="datetime-local">
    <input id="endTime"  type="datetime-local">
    <button id="rangeBtn" class="btn">åŒºé—´æŸ¥è¯¢</button>

    <!-- æ–°å¢ï¼šæŒ‰å¤©ç»Ÿè®¡ï¼ˆå¯å…¨é‡æˆ–æŒ‰å•å¸ï¼‰ -->
    <input id="dailyToken" type="text" placeholder="(å¯é€‰)æŒ‰å¤©ç»Ÿè®¡ï¼šä»£å¸åç§°">
    <input id="dailyStart" type="date" title="å¼€å§‹æ—¥æœŸ">
    <input id="dailyEnd"   type="date" title="ç»“æŸæ—¥æœŸ">
    <button id="dailyBtn" class="btn">æŒ‰å¤©ç»Ÿè®¡</button>
  </div>

  <div id="author">
    ä½œè€…Â <a href="https://twitter.com/0xXIAOc" target="_blank">@0xXIAOc</a>
  </div>
</div>

<div id="customVol"></div>
<div id="dailyBox"></div>

<table id="tokenTable">
  <thead>
    <tr>
      <th style="width:26px"></th><th>#</th><th>ä»£å¸åå­—</th>
      <th id="thPrice">ä»·æ ¼</th>
      <th id="thVol24h" class="sortable" data-key="vol24h">24Hâ€¯äº¤æ˜“é‡</th>
      <th>24Hâ€¯å˜åŒ–</th>
      <th id="thToday" class="sortable" data-key="todayQV">å½“å¤©é™ä»·å•æˆäº¤é¢</th>
      <th id="thPrev"  class="sortable" data-key="prevQV">å‰ä¸€å¤©é™ä»·å•æˆäº¤é¢</th>
    </tr>
  </thead>
  <tbody><tr><td colspan="8">åŠ è½½ä¸­â€¦</td></tr></tbody>
</table>

<div id="toast"></div>
<footer></footer>

<script>
/* ---------- å¸¸é‡ & å·¥å…· ---------- */
const LIST_API='https://www.binance.com/bapi/defi/v1/public/wallet-direct/buw/wallet/cex/alpha/all/token/list';
const K_API  ='https://www.binance.com/bapi/defi/v1/public/alpha-trade/klines';
const nf0=new Intl.NumberFormat('en-US',{maximumFractionDigits:0});
const nf2=new Intl.NumberFormat('en-US',{minimumFractionDigits:2,maximumFractionDigits:2});
const FAV_KEY='alphaFavs',CONCURRENCY=5;
const fmtShort=ts=>new Intl.DateTimeFormat('zh-CN',
  {timeZone:'Asia/Shanghai',hour12:false,month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'})
  .format(new Date(ts)).replace(/\//g,'-');
const fmtFull=ts=>new Intl.DateTimeFormat('zh-CN',
  {timeZone:'Asia/Shanghai',hour12:false,year:'numeric',month:'2-digit',day:'2-digit',
  hour:'2-digit',minute:'2-digit',second:'2-digit'})
  .format(new Date(ts)).replace(/\//g,'-');
const nearest8UTC=()=>{const n=new Date(),b=new Date();b.setHours(8,0,0,0);if(n<b)b.setDate(b.getDate()-1);return b.getTime();};
/* æ–°å¢ï¼šå°†â€œä¸Šæµ·æ—¶åŒºâ€æ—¥å†æ—¶é—´è½¬æ¢ä¸ºå¯¹åº” UTC æ—¶é—´æˆ³ï¼ˆmsï¼‰
   ä¾‹å¦‚ shanghaiTs(2025,8,17,8) è¡¨ç¤º 2025-08-17 08:00:00 Asia/Shanghai å¯¹åº”çš„ UTC æ¯«ç§’æ•° */
const shanghaiTs=(y,m,d,h=0,mi=0,s=0,ms=0)=>Date.UTC(y,m-1,d,h-8,mi,s,ms);
const fmtYmd=ts=>new Intl.DateTimeFormat('zh-CN',{timeZone:'Asia/Shanghai',year:'numeric',month:'2-digit',day:'2-digit'})
  .format(new Date(ts)).replace(/\//g,'-');

/* ---------- DOM ---------- */
const tbody=document.querySelector('#tokenTable tbody');
const refreshBtn=document.getElementById('refreshBtn');
const progressEl=document.getElementById('progress');
const lastUpEl=document.getElementById('lastUp');
const thToday=document.getElementById('thToday');
const thPrev =document.getElementById('thPrev');
const toast  =document.getElementById('toast');
const tokenEl=document.getElementById('tokenInput');
const startEl=document.getElementById('startTime');
const endEl  =document.getElementById('endTime');
const rangeBtn=document.getElementById('rangeBtn');
const customVolEl=document.getElementById('customVol');
/* æ–°å¢ï¼šæŒ‰å¤©ç»Ÿè®¡æ§ä»¶ */
const dailyTokenEl=document.getElementById('dailyToken');
const dailyStartEl=document.getElementById('dailyStart');
const dailyEndEl=document.getElementById('dailyEnd');
const dailyBtn=document.getElementById('dailyBtn');
const dailyBox=document.getElementById('dailyBox');

/* ---------- Toast ---------- */
function showToast(msg){
  toast.textContent=msg;toast.style.opacity='1';
  setTimeout(()=>toast.style.opacity='0',3000);
}

/* ---------- çŠ¶æ€ ---------- */
let rows=[],filter='',sortKey='vol24h',sortDir='desc';
window._boundary=nearest8UTC();

/* ---------- å¹¶å‘é™åˆ¶ ---------- */
function pLimit(n){
  const q=[];let run=0;
  const next=()=>{if(run>=n||!q.length)return;run++;q.shift()().finally(()=>{run--;next();});};
  return fn=>new Promise(res=>{q.push(()=>fn().then(res));next();});
}
const limit=pLimit(CONCURRENCY);

/* ---------- Quote Volume ---------- */
async function qv(sym,start,end){
  if(start>=end)return 0;
  const url=`${K_API}?symbol=${sym}&interval=1h&startTime=${start}&endTime=${end}&limit=1500`;
  try{
    const {data=[]}=await fetch(url).then(r=>r.json());
    return data.reduce((s,k)=>s+parseFloat(k[7]),0);
  }catch{return 0;}
}
async function fillQVAll(list,today8,yest8,endTs){
  let done=0,total=list.length;
  progressEl.style.display='inline-block';
  await Promise.all(list.map(r=>limit(async()=>{
    [r.todayQV,r.prevQV]=await Promise.all([
      qv(r.sym,today8,endTs),
      qv(r.sym,yest8,today8-1)
    ]);
    progressEl.textContent=`${Math.floor(++done/total*100)}%`;
  })));
  progressEl.style.display='none';
}

/* ---------- æ”¶è— ---------- */
const favs=()=>JSON.parse(localStorage.getItem(FAV_KEY)||'[]');
function toggleFav(sym){
  const f=favs();const i=f.indexOf(sym);
  i>-1?f.splice(i,1):f.push(sym);
  localStorage.setItem(FAV_KEY,JSON.stringify(f));
  showToast(i>-1?'å·²ç§»é™¤æ”¶è—':'å·²åŠ å…¥æ”¶è—');
  render();
}

/* ---------- æ‹‰å–åˆ—è¡¨ ---------- */
async function fetchList(){
  const resp=await fetch(LIST_API);
  if(!resp.ok)throw new Error('LIST_API Error');
  const {data=[]}=await resp.json();
  return data.filter(t=>+t.volume24h>0).map(t=>({
    price:+t.price,vol24h:+t.volume24h,chg:+t.percentChange24h,
    symbol:t.symbol,icon:t.iconUrl,sym:`${t.alphaId}USDT`,
    todayQV:0,prevQV:0
  }));
}

/* ---------- æ’åº & æ¸²æŸ“ ---------- */
function sortRows(arr){return [...arr].sort((a,b)=>sortDir==='desc'?b[sortKey]-a[sortKey]:a[sortKey]-b[sortKey]);}
function updateSortIcons(){
  document.querySelectorAll('th.sortable').forEach(th=>{
    th.classList.remove('asc','desc');
    if(th.dataset.key===sortKey)th.classList.add(sortDir);
  });
}
function render(){
  const favSet=new Set(favs());
  const filtered=rows.filter(r=>r.symbol.toLowerCase().includes(filter)||r.sym.toLowerCase().includes(filter));
  const sorted=sortRows(filtered);
  const display=[...sorted.filter(x=>favSet.has(x.sym)),...sorted.filter(x=>!favSet.has(x.sym))];
  tbody.innerHTML=display.map((t,i)=>`
    <tr data-sym="${t.sym}">
      <td class="star ${favSet.has(t.sym)?'fav':''}">${favSet.has(t.sym)?'â˜…':'â˜†'}</td>
      <td>${i+1}</td>
      <td><img class="logo" loading="lazy" src="${t.icon}" referrerpolicy="no-referrer"
       onerror="this.src='https://bin.bnbstatic.com/static/images/common/base-token-default.png'">${t.symbol}</td>
      <td>${nf2.format(t.price)}</td>
      <td>${nf0.format(t.vol24h)}</td>
      <td class="${t.chg>=0?'up':'down'}">${t.chg.toFixed(2)}%</td>
      <td>${t.todayQV?nf0.format(t.todayQV):'â€¦'}</td>
      <td>${t.prevQV?nf0.format(t.prevQV):'â€¦'}</td>
    </tr>`).join('');
  updateSortIcons();
}

/* ---------- åˆ·æ–°æ•°æ® ---------- */
async function reloadAll(){
  refreshBtn.disabled=true;progressEl.textContent='0%';
  const today8=nearest8UTC(),yest8=today8-864e5,endTs=Date.now();
  thToday.innerHTML=`å½“å¤©é™ä»·å•æˆäº¤é¢<span class="subl">(${fmtShort(today8)}Â ~Â ${fmtShort(endTs)})</span>`;
  thPrev.innerHTML=`å‰ä¸€å¤©é™ä»·å•æˆäº¤é¢<span class="subl">(${fmtShort(yest8)}Â ~Â ${fmtShort(today8-1)})</span>`;
  try{
    rows=await fetchList();
    await fillQVAll(rows,today8,yest8,endTs);
    render();
    lastUpEl.textContent=`æœ€åæ›´æ–°æ—¶é—´ï¼šÂ ${fmtFull(Date.now())}`;
    window._boundary=today8;
  }catch(e){
    console.error(e);
    tbody.innerHTML='<tr><td colspan="8">åŠ è½½å¤±è´¥â€¦</td></tr>';
    showToast('åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
  }finally{
    refreshBtn.disabled=false;
  }
}

/* ---------- è‡ªå®šä¹‰åŒºé—´æŸ¥è¯¢ï¼ˆå•å¸æ€»é‡ï¼‰ ---------- */
(function initDateInputs(){
  const now=new Date();
  const pad=n=>String(n).padStart(2,'0');
  const toLocal=d=>`${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}`;
  startEl.value=toLocal(new Date(nearest8UTC()));
  endEl.value  =toLocal(now);

  /* æ–°å¢ï¼šæŒ‰å¤©ç»Ÿè®¡çš„æ—¥æœŸé»˜è®¤å€¼ï¼ˆæœ€è¿‘ 3 å¤©ï¼‰ */
  const shNow=new Date();
  const y=shNow.getFullYear(), m=pad(shNow.getMonth()+1), d=pad(shNow.getDate());
  const oneDay=86400000;
  const dt = (t)=>{const dd=new Date(t);return `${dd.getFullYear()}-${pad(dd.getMonth()+1)}-${pad(dd.getDate())}`;};
  const todayStr = dt(shNow.getTime());
  const prev2Str = dt(shNow.getTime()-2*oneDay);
  dailyStartEl.value = prev2Str;
  dailyEndEl.value   = todayStr;
})();
rangeBtn.addEventListener('click',async()=>{
  const symIn=tokenEl.value.trim();
  if(!symIn){showToast('è¯·è¾“å…¥ä»£å¸ç¬¦å·');return;}
  let row=rows.find(r=>r.symbol.toLowerCase()===symIn.toLowerCase()||r.sym.toLowerCase()===symIn.toLowerCase());
  if(!row){
    const m=symIn.match(/_(\d+)/);if(m)row={sym:`${m[1]}USDT`,symbol:symIn};
  }
  if(!row){showToast('æœªæ‰¾åˆ°è¯¥ä»£å¸');return;}
  const st=new Date(startEl.value).getTime(),et=new Date(endEl.value).getTime();
  if(!st||!et||st>=et){showToast('æ—¶é—´èŒƒå›´ä¸åˆæ³•');return;}
  rangeBtn.disabled=true;progressEl.textContent='æŸ¥è¯¢â€¦';progressEl.style.display='inline-block';
  const vol=await qv(row.sym,st,et);
  rangeBtn.disabled=false;progressEl.style.display='none';
  customVolEl.innerHTML=`<strong>${row.symbol||symIn}</strong> åœ¨&nbsp;<span>${fmtFull(st)}</span> ~ <span>${fmtFull(et)}</span> çš„é™ä»·å•æˆäº¤é¢ï¼š<strong>${nf0.format(vol)}</strong>`;
});

/* ---------- æ–°å¢ï¼šæŒ‰å¤©ç»Ÿè®¡ï¼ˆå¯å…¨é‡æˆ–å•å¸ï¼‰ ---------- */
async function ensureRows(){ if(!rows.length){ rows = await fetchList(); } }
function parseDateStr(s){
  // s: 'YYYY-MM-DD'
  const m=/^(\d{4})-(\d{2})-(\d{2})$/.exec(s||'');
  if(!m) return null;
  return {y:+m[1],m:+m[2],d:+m[3]};
}
async function dailyStats(){
  const tokenIn = (dailyTokenEl.value||'').trim();
  const startStr = dailyStartEl.value;
  const endStr   = dailyEndEl.value;
  const sObj=parseDateStr(startStr), eObj=parseDateStr(endStr);
  if(!sObj||!eObj){showToast('è¯·é€‰æ‹©æœ‰æ•ˆçš„å¼€å§‹/ç»“æŸæ—¥æœŸ');return;}
  const start8 = shanghaiTs(sObj.y,sObj.m,sObj.d,8);
  const end8   = shanghaiTs(eObj.y,eObj.m,eObj.d,8);
  if(end8<start8){showToast('æ—¥æœŸèŒƒå›´ä¸åˆæ³•');return;}

  dailyBtn.disabled=true;
  progressEl.textContent='0%';
  progressEl.style.display='inline-block';

  await ensureRows();

  // è§£æä»£å¸ï¼šç•™ç©º => ç»Ÿè®¡å…¨éƒ¨ä»£å¸ï¼›å¦åˆ™ä»…ç»Ÿè®¡è¯¥å¸
  let targetSym=null, title='';
  if(tokenIn){
    const r = rows.find(x=>x.symbol.toLowerCase()===tokenIn.toLowerCase()||x.sym.toLowerCase()===tokenIn.toLowerCase());
    if(r){ targetSym=r.sym; title = `${r.symbol}`; }
    else{
      const m = tokenIn.match(/_(\d+)/);
      if(m){ targetSym = `${m[1]}USDT`; title = tokenIn; }
      else{ showToast('æœªæ‰¾åˆ°è¯¥ä»£å¸'); dailyBtn.disabled=false; progressEl.style.display='none'; return; }
    }
  }else{
    title = 'å…¨éƒ¨ Alpha ä»£å¸ï¼ˆæ€»é‡ï¼‰';
  }

  // ç”Ÿæˆæ—¥çª—å£ï¼ˆå«ç»“æŸæ—¥ï¼‰
  const days=[];
  for(let ts=start8; ts<=end8; ts+=86400000){
    const st=ts, et=ts+86400000-1;
    days.push([st,et]);
  }

  const totals=new Array(days.length).fill(0);
  let done=0, totalTasks = days.length * (targetSym?1:rows.length);

  // ç»Ÿè®¡
  if(targetSym){
    await Promise.all(days.map(([st,et],i)=>limit(async()=>{
      const v=await qv(targetSym,st,et);
      totals[i]+=v;
      progressEl.textContent=`${Math.floor(++done/totalTasks*100)}%`;
    })));
  }else{
    // å…¨éƒ¨ä»£å¸ï¼šå¯¹æ¯ä¸ªæ—¥çª—æ±‡æ€»æ‰€æœ‰ sym
    const syms = rows.map(r=>r.sym);
    await Promise.all(days.map(([st,et],i)=>Promise.all(
      syms.map(sym=>limit(async()=>{
        const v=await qv(sym,st,et);
        totals[i]+=v;
        progressEl.textContent=`${Math.floor(++done/totalTasks*100)}%`;
      }))
    )));
  }

  progressEl.style.display='none';
  dailyBtn.disabled=false;

  // æ¸²æŸ“ç»“æœ
  const rowsHTML = totals.map((v,idx)=>{
    const [st,et]=days[idx];
    return `<tr>
      <td>${fmtYmd(st)}</td>
      <td class="subl">${fmtShort(st)} ~ ${fmtShort(et)}</td>
      <td><strong>${nf0.format(v)}</strong></td>
    </tr>`;
  }).join('');
  const sum = totals.reduce((a,b)=>a+b,0);
  const avg = totals.length? sum / totals.length : 0;

  dailyBox.innerHTML = `
    <h3>æŒ‰å¤©ç»Ÿè®¡ï¼ˆ${title}ï¼‰</h3>
    <p class="tip">å£å¾„ï¼šä¸Šæµ·æ—¶åŒº <strong>08:00</strong> è‡³æ¬¡æ—¥ <strong>08:00</strong> ä¸ºä¸€å¤©ï¼›å…± <strong>${totals.length}</strong> å¤©ã€‚</p>
    <table>
      <thead><tr><th>æ—¥æœŸ</th><th>æ—¶é—´çª—å£</th><th>é™ä»·å•æˆäº¤é¢</th></tr></thead>
      <tbody>${rowsHTML}</tbody>
      <tfoot>
        <tr><td>åˆè®¡</td><td></td><td>${nf0.format(sum)}</td></tr>
        <tr><td>æ—¥å‡</td><td></td><td>${nf0.format(avg)}</td></tr>
      </tfoot>
    </table>
  `;
}

/* ç»‘å®šäº‹ä»¶ï¼šæŒ‰å¤©ç»Ÿè®¡ */
dailyBtn.addEventListener('click', dailyStats);

/* ---------- å…¶å®ƒäº‹ä»¶ ---------- */
document.getElementById('search').addEventListener('input',e=>{
  filter=e.target.value.trim().toLowerCase();render();
});
tbody.addEventListener('click',e=>{
  const s=e.target.closest('.star');
  if(s){s.classList.add('bounce');setTimeout(()=>s.classList.remove('bounce'),150);toggleFav(s.closest('tr').dataset.sym);}
});
document.querySelectorAll('th.sortable').forEach(th=>{
  th.addEventListener('click',()=>{
    const key=th.dataset.key;
    sortDir=(sortKey===key&&sortDir==='desc')?'asc':'desc';sortKey=key;render();
  });
});

/* â˜… ç»‘å®šåˆ·æ–°æŒ‰é’® */
refreshBtn.addEventListener('click', reloadAll);

/* ---------- è‡ªåˆ·æ–° ---------- */
document.addEventListener('visibilitychange',()=>{
  if(document.visibilityState==='visible'&&nearest8UTC()!==window._boundary)reloadAll();
});
setInterval(()=>{if(document.visibilityState==='visible')reloadAll();},300000);

/* ---------- é¦–æ¬¡åŠ è½½ ---------- */
reloadAll();
</script>
</body>
</html>
